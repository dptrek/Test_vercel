<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Upload JSON to GitHub Repo</title>
<style>
body { font-family: sans-serif; max-width: 600px; margin: 40px auto; }
button { margin-top: 12px; padding: 8px 16px; cursor: pointer; }
pre { background: #f7f7f7; padding: 10px; margin-top: 15px; white-space: pre-wrap; word-break: break-all; }
#fileName { margin-top: 10px; font-style: italic; }
</style>
</head>
<body>
<h2>Upload JSON File to GitHub Repository</h2>

<input type="file" id="fileInput" accept=".json" style="display:none;">

<button id="chooseBtn">Choose JSON File</button>
<span id="fileName">No file selected</span>
<br>
<button id="uploadBtn">Upload</button>

<pre id="output"></pre>

<script>
const fileInput = document.getElementById("fileInput");
const chooseBtn = document.getElementById("chooseBtn");
const fileNameSpan = document.getElementById("fileName");
const uploadBtn = document.getElementById("uploadBtn");
const output = document.getElementById("output");

chooseBtn.onclick = () => fileInput.click();

fileInput.onchange = () => {
  if (fileInput.files.length) {
    fileNameSpan.textContent = fileInput.files[0].name;
  } else {
    fileNameSpan.textContent = "No file selected";
  }
};

async function uploadFile(file) {
  const content = await file.text();
  const base64Content = btoa(unescape(encodeURIComponent(content)));

  const res = await fetch("/api/upload", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      fileName: file.name,
      content: base64Content
    })
  });

  if (!res.ok) {
    const text = await res.text();
    throw new Error(text);
  }

  return await res.json();
}

uploadBtn.onclick = async () => {
  if (!fileInput.files.length) {
    output.textContent = "Please choose a JSON file first.";
    return;
  }

  const file = fileInput.files[0];
  output.textContent = "Uploading: " + file.name + "...";

  try {
    const result = await uploadFile(file);
    output.textContent = "Upload successful!";
  } catch (err) {
    output.textContent = "Upload failed: " + err.message;
  }
};
</script>
</body>
</html>
